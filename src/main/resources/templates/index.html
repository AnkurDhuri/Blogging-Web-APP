<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <title>Home - Thoughts</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
    <div class="container">
        <a class="navbar-brand" href="/">Thoughts</a>
        <div class="d-flex">

            <!-- Search Form (always visible) -->
            <form th:action="@{/search}" method="get" class="d-flex me-3" role="search">
                <input class="form-control me-2" type="search" name="username" placeholder="Search by username" aria-label="Search" required>
                <button class="btn btn-outline-light" type="submit">Search</button>
            </form>

            <div sec:authorize="isAnonymous()">
                <a class="btn btn-outline-light me-2" href="/register">Register</a>
                <a class="btn btn-light" href="/login">Login</a>
            </div>

            <div sec:authorize="isAuthenticated()">
                <a class="btn btn-outline-light me-2" th:href="@{/profile/me}">My Profile</a>
                <a class="btn btn-light me-2" href="/post/new">New Post</a>
                <span class="navbar-text me-3">
                    Welcome, <strong sec:authentication="principal.username"></strong>
                </span>
                <form th:action="@{/logout}" method="post" class="d-inline">
                    <button type="submit" class="btn btn-outline-light">Logout</button>
                </form>
            </div>
        </div>
    </div>
</nav>


<div class="container">
    <h2 class="mb-4">Latest Posts</h2>
    <div th:each="post : ${posts}" class="card mb-3 shadow-sm">
        <div class="card-body">
            <h5 th:text="${post.title}" class="card-title"></h5>
            <p th:text="${post.content}" class="card-text"></p>
            <a th:href="@{/user/{id}(id=${post.user.id})}" class="text-muted">
                â€” <span th:text="${post.user.username}"></span>
            </a>

            <div class="mt-2" sec:authorize="isAuthenticated()"
                 th:if="${#authentication.name} == ${post.user.email}">
                <a th:href="@{/post/edit/{id}(id=${post.id})}" class="btn btn-sm btn-warning">Edit</a>
                <a th:href="@{/post/delete/{id}(id=${post.id})}" class="btn btn-sm btn-danger">Delete</a>
            </div>
        </div>
    </div>
</div>

</body>
</html>